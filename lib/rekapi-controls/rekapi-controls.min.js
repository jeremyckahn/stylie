/**
 * Rekapi Controls - UI controls for Rekapi animations. v0.3.6
 *   By Jeremy Kahn - jeremyckahn@gmail.com
 *   https://github.com/jeremyckahn/rekapi-controls
 *
 * Make Rekapi animations interactive and fun.
 * Dependencies: Rekapi (https://github.com/jeremyckahn/rekapi), Underscore.js (https://github.com/documentcloud/underscore), Shifty.js (https://github.com/jeremyckahn/shifty), jQuery (https://github.com/jquery/jquery)
 * MIT Lincense.  This code free to use, modify, distribute and enjoy.
 */
(function(i){function j(d,e,c){var a=c.width(),d=e.find(".dragon-slider"),a=a-parseInt(d.css("border-left-width"),10),a=a-parseInt(d.css("border-right-width"),10),a=a-d.find(".dragon-slider-handle").outerWidth();e.find(".rekapi-scrubber-button").each(function(d,c){a-=g(c).outerWidth()});return a}function b(d,e){var c,a;this.kapi=d;this.$contextEl=g(e);c=g(d.context);a=g(k);c.after(a);this.$container=a=c.next();c=a.find(".rekapi-scrubber-timeline");c.dragonSlider({drag:g.proxy(function(a){d.pause();
this.syncAnimationToPercent(a)},this)});this.$timeline=c;a.width(this.$contextEl.width());c.width(j(d,a,this.$contextEl));this.syncPlayStateButtons();var b=this,f,h;f=b.kapi;a=b.$container.find(".rekapi-scrubber-play");c=b.$container.find(".rekapi-scrubber-pause");h=b.$container.find(".rekapi-scrubber-stop");a.on("click",function(a){a.preventDefault();f.play()});c.on("click",function(a){a.preventDefault();f.pause()});h.on("click",function(a){a.preventDefault();f.stop(!0)});f.on("playStateChange",
function(){b.syncPlayStateButtons()});f.on("stop",function(){b.resetScrubber()});f.on("afterUpdate",function(){b.updateScrubber()});return this}var k='<div class="rekapi-scrubber-wrapper"><div class="rekapi-scrubber"><a class="rekapi-scrubber-button rekapi-scrubber-play ui-corner-all" href="#"><span class="ui-icon ui-icon-play"></span></a><a class="rekapi-scrubber-button rekapi-scrubber-pause ui-corner-all" href="#"><span class="ui-icon ui-icon-pause"></span></a><div class="rekapi-scrubber-timeline"></div><a class="rekapi-scrubber-button rekapi-scrubber-stop ui-corner-all" href="#"><span class="ui-icon ui-icon-stop"></span></a></div></div>',
g=jQuery;b.prototype.syncPlayStateButtons=function(){var d,b,c;d=this.kapi;b=this.$container.find(".rekapi-scrubber-play");c=this.$container.find(".rekapi-scrubber-pause");d.isPlaying()?(b.css({display:"none"}),c.css({display:"block"})):(b.css({display:"block"}),c.css({display:"none"}));return this};b.prototype.updateScrubber=function(){this.$timeline.dragonSliderSet(this.kapi.lastPositionUpdated(),!1)};b.prototype.resetScrubber=function(){this.$timeline.dragonSliderSet(0,!1)};b.prototype.syncAnimationToScrubber=
function(){this.syncAnimationToPercent(this.$timeline.dragonSliderGet())};b.prototype.syncAnimationToPercent=function(b){this.syncAnimationToMillisecond(b*this.kapi.animationLength())};b.prototype.syncAnimationToMillisecond=function(b){var e;e=Tweenable.now();this.kapi.update(b);this.kapi._loopTimestamp=e-b;this.kapi._pausedAtTime=e};i.RekapiScrubber=b})(this);
