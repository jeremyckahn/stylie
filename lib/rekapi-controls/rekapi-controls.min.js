/**
 * Rekapi Controls - UI controls for Rekapi animations. v0.3.5
 *   By Jeremy Kahn - jeremyckahn@gmail.com
 *   https://github.com/jeremyckahn/rekapi-controls
 *
 * Make Rekapi animations interactive and fun.
 * Dependencies: Rekapi (https://github.com/jeremyckahn/rekapi), Underscore.js (https://github.com/documentcloud/underscore), Shifty.js (https://github.com/jeremyckahn/shifty), jQuery (https://github.com/jquery/jquery)
 * MIT Lincense.  This code free to use, modify, distribute and enjoy.
 */
(function(g){function h(a,b,d){var c=d.width(),a=b.find(".dragon-slider"),c=c-parseInt(a.css("border-left-width"),10),c=c-parseInt(a.css("border-right-width"),10),c=c-a.find(".dragon-slider-handle").outerWidth();b.find(".rekapi-scrubber-button").each(function(a,b){c-=f(b).outerWidth()});return c}function i(a){var b,d,c,e;b=a.kapi;d=a.$container.find(".rekapi-scrubber-play");c=a.$container.find(".rekapi-scrubber-pause");e=a.$container.find(".rekapi-scrubber-stop");d.on("click",function(a){a.preventDefault();
b.play()});c.on("click",function(a){a.preventDefault();b.pause()});e.on("click",function(a){a.preventDefault();b.stop(!0)});b.on("playStateChange",function(){a.syncPlayStateButtons()});b.on("stop",function(){a.resetScrubber()});b.on("afterUpdate",function(){a.updateScrubber()})}function e(a,b){var d,c;this.kapi=a;this.$contextEl=f(b);d=f(a.context);c=f(j);d.after(c);this.$container=c=d.next();d=c.find(".rekapi-scrubber-timeline");d.dragonSlider({drag:f.proxy(function(b){a.pause();this.syncAnimationToPercent(b)},
this)});this.$timeline=d;c.width(this.$contextEl.width());d.width(h(a,c,this.$contextEl));this.syncPlayStateButtons();i(this);return this}var j='<div class="rekapi-scrubber-wrapper"><div class="rekapi-scrubber"><a class="rekapi-scrubber-button rekapi-scrubber-play ui-corner-all" href="#"><span class="ui-icon ui-icon-play"></span></a><a class="rekapi-scrubber-button rekapi-scrubber-pause ui-corner-all" href="#"><span class="ui-icon ui-icon-pause"></span></a><div class="rekapi-scrubber-timeline"></div><a class="rekapi-scrubber-button rekapi-scrubber-stop ui-corner-all" href="#"><span class="ui-icon ui-icon-stop"></span></a></div></div>',
f=jQuery;e.prototype.syncPlayStateButtons=function(){var a,b,d;a=this.kapi;b=this.$container.find(".rekapi-scrubber-play");d=this.$container.find(".rekapi-scrubber-pause");a.isPlaying()?(b.css({display:"none"}),d.css({display:"block"})):(b.css({display:"block"}),d.css({display:"none"}));return this};e.prototype.updateScrubber=function(){this.$timeline.dragonSliderSet(this.kapi.lastPositionUpdated(),!1)};e.prototype.resetScrubber=function(){this.$timeline.dragonSliderSet(0,!1)};e.prototype.syncAnimationToScrubber=
function(){this.syncAnimationToPercent(this.$timeline.dragonSliderGet())};e.prototype.syncAnimationToPercent=function(a){this.syncAnimationToMillisecond(a*this.kapi.animationLength())};e.prototype.syncAnimationToMillisecond=function(a){var b;b=Tweenable.util.now();this.kapi.update(a);this.kapi._loopTimestamp=b-a;this.kapi._pausedAtTime=b};g.RekapiScrubber=e})(this);
