define("src/utils",[],function(){var a={};return a.init=function(a){a.util.pxToNumber=function(a){return+a.replace("px","")},a.util.trimString=function(a){return a.replace(/^\s*|\s*$/g,"")},a.util.moveLastKeyframe=function(b,c){var c=+c,d=b.getTrackNames(),e=b.getTrackLength(d[0])-1;_.each(d,function(a){b.modifyKeyframeProperty(a,e,{millisecond:c})}),b.kapi._recalculateAnimationLength(),a.config.animationDuration=c},a.util.getFormulaFromEasingFunc=function(a){var b=a.toString().replace("\n",""),c=b.replace(/.*return\s*/g,""),d=c.replace(/\}|;\s*}$/g,"");return d},a.util.redrawKapi=function(a){a.update(a.lastPositionUpdated()*a.animationLength())}},a}),define("src/ui/checkbox",["exports"],function(a){a.view=Backbone.View.extend({events:{change:"_onChange"},initialize:function(a){_.extend(this,a),a.preventInitialHandlerCall&&(this.delegateEvents(),this.$el.trigger("change"))},_onChange:function(a){this.onChange.call(this,a,this.$el.attr("checked")==="checked")}})}),define("src/ui/button",["exports"],function(a){a.view=Backbone.View.extend({events:{click:"onClick"},initialize:function(a){_.extend(this,a),this.delegateEvents()},onClick:function(){}})}),define("src/ui/select",["exports"],function(a){function b(a){var b=a.config.selects.x.$el.val(),c=a.config.selects.y.$el.val();return b+" "+c}a.view=Backbone.View.extend({events:{change:"onChange"},initialize:function(a){_.extend(this,a),_.each(Tweenable.prototype.formula,function(a,b){var c=$(document.createElement("option"),{value:b});c.html(b),this.$el.append(c)},this)},onChange:function(a){this.app.config.currentActor.modifyKeyframe(this.app.config.animationDuration,{},{transform:b(this.app)}),this.app.canvasView.backgroundView.update(),this.app.util.redrawKapi(this.app.kapi)}})}),define("src/ui/auto-update-textfield",["exports"],function(a){a.view=Backbone.View.extend({events:{keyup:"onKeyup",keydown:"onKeydown"},initialize:function(a){_.extend(this,a)},onKeyup:function(a){var b=this.$el.val();this.onValReenter&&this.onValReenter(b)},onKeydown:function(a){var b=a.which;b==38&&this.onArrowUp?this.onArrowUp():b==40&&this.onArrowDown&&this.onArrowDown()}})}),define("src/ui/ease-field",["exports","./auto-update-textfield"],function(easeField,autoUpdateTextfield){easeField.view=autoUpdateTextfield.view.extend({initialize:function(a){autoUpdateTextfield.view.prototype.initialize.apply(this,arguments);var b=this.$el.data("easename"),c=Tweenable.prototype.formula[b],d=this.app.util.getFormulaFromEasingFunc(c);this.$el.val(d),this.$el.data("lastvalidfn",d)},onValReenter:function(val){var easename=this.$el.data("easename"),lastValid=this.$el.data("lastvalidfn");if(lastValid===val)return;try{eval("Tweenable.prototype.formula."+easename+" = function (x) {return "+val+"}"),this.$el.data("lastvalidfn",val),this.$el.removeClass("error"),this.app.canvasView.backgroundView.update(),this.app.util.redrawKapi(this.app.kapi)}catch(ex){eval("Tweenable.prototype.formula."+easename+" = function (x) {return "+lastValid+"}"),this.$el.addClass("error")}}})}),define("src/ui/background",["exports"],function(a){a.view=Backbone.View.extend({initialize:function(a){_.extend(this,a),this.context=this.$el[0].getContext("2d"),this.$el.css("background","#eee"),this.resize({height:a.height,width:a.width})},resize:function(a){_.each(["height","width"],function(b){if(b in a){var c={};c[b]=a[b],this.$el.css(c).attr(c)}},this)},generatePathPoints:function(a,b,c,d,e,f){var g=[],h={x:a,y:b},i={x:c,y:d},j={x:e,y:f},k,l;for(k=0;k<=this.app.const.RENDER_GRANULARITY;k++)l=Tweenable.util.interpolate(h,i,1/this.app.const.RENDER_GRANULARITY*k,j),g.push(l);return g},generatePathPrerender:function(a,b,c,d,e,f){this.app.config.prerenderedPath=document.createElement("canvas"),this.app.config.prerenderedPath.width=this.app.canvasView.$canvasBG.width(),this.app.config.prerenderedPath.height=this.app.canvasView.$canvasBG.height();var g=this.app.config.prerenderedPath.ctx=this.app.config.prerenderedPath.getContext("2d"),h=this.generatePathPoints.apply(this,arguments),i;g.beginPath(),_.each(h,function(a){i?g.lineTo(a.x,a.y):g.moveTo(a.x,a.y),i=a}),g.lineWidth=1,g.strokeStyle="#fa0",g.stroke(),g.closePath()},update:function(){var a=this.app.collection.keyframes.first().getAttrs(),b=this.app.collection.keyframes.last().getAttrs();this.generatePathPrerender(a.x,a.y,b.x,b.y,this.app.config.selects.x.$el.val(),this.app.config.selects.y.$el.val()),this.app.config.prerenderedPath&&(this.$el[0].width=this.$el.width(),this.app.config.isPathShowing&&this.context.drawImage(this.app.config.prerenderedPath,0,0))}})}),define("src/ui/canvas",["exports","src/ui/background"],function(a,b){var c=$(window),d=$("header");a.view=Backbone.View.extend({initialize:function(a){_.extend(this,a),this.initDOM()},initDOM:function(){var a=c.height(),d=c.width();this.app.kapi=new Kapi({context:this.$el[0],height:a,width:d}),this.backgroundView=new b.view({app:this.app,$el:this.$canvasBG,height:a,width:d});var e=this.getDOMActor();this.app.kapi.addActor(e),this.app.config.currentActor=e,this.setDOMKeyframePoints(e),this.initRekapiControls(),c.on("resize",_.bind(this.onWindowResize,this))},onWindowResize:function(a){var b=c.height()-d.outerHeight(),e=c.width();this.app.kapi.canvasHeight(b),this.app.kapi.canvasWidth(e),this.backgroundView.resize({height:b,width:e}),this.backgroundView.update()},initRekapiControls:function(){this.app.kapi.controls=new RekapiScrubber(this.app.kapi,this.$canvasBG[0])},getDOMActor:function(){var a=$("#rekapi-canvas").children();return a.height(a.height()).width(a.width()),new Kapi.DOMActor(a[0])},setDOMKeyframePoints:function(a){a.keyframe(0,this.app.collection.keyframes.first().getCSS(),"linear linear").keyframe(+this.app.config.initialDuration,this.app.collection.keyframes.last().getCSS(),"linear linear")}})}),define("src/ui/pane",["exports"],function(a){var b=$(window);a.view=Backbone.View.extend({CONTAINER_TEMPLATE:['<div class="pane"></div>'].join(""),HANDLE_TEMPLATE:['<div class="pane-handle"></div>'].join(""),CONTENT_WRAPPER_TEMPLATE:['<div class="pane-content"></div>'].join(""),events:{},initialize:function(a){_.extend(this,a),this.$handle=$(this.HANDLE_TEMPLATE),this.$el.wrap($(this.CONTAINER_TEMPLATE)),this.$el=this.$el.parent(),this.$el.wrapInner($(this.CONTENT_WRAPPER_TEMPLATE)).prepend(this.$handle).css({left:b.width()-this.$el.outerWidth(!0)}).dragon({within:this.$el.parent(),handle:".pane-handle",onDragEnd:_.bind(this.onDragStop,this)}),this.oldSize=this.getSize()},onResize:function(){this.oldSize=this.getSize()},onDragStop:function(a,b){this.$el.position().top<0&&this.$el.css("top","0px")},getSize:function(){return{height:this.$el.height(),width:this.$el.width()}}})}),define("src/ui/tabs",["exports"],function(a){a.view=Backbone.View.extend({ACTIVE_CLASS:"tabs-active",events:{"click .tabs li":"onTabClick"},initialize:function(a){_.extend(this,a),this.delegateEvents(),this.tabs=this.$el.find(".tabs").children(),this.contents=this.$el.find(".tabs-contents").children(),this.tabs.eq(0).trigger("click")},onTabClick:function(a){a.preventDefault();var b=$(a.currentTarget);this.tabs.removeClass(this.ACTIVE_CLASS),b.addClass(this.ACTIVE_CLASS),this.contents.css("display","none"),$("#"+b.data("target")).css("display","block")}})}),define("src/ui/css-output",["exports"],function(a){function c(a){var c=[];return _.each(a.config.activeClasses,function(a,d){a&&c.push(b[d])}),c}var b={moz:"mozilla",webkit:"webkit",w3:"w3"};a.view=Backbone.View.extend({events:{},initialize:function(a){_.extend(this,a),this.$trigger.on("click",_.bind(this.onTriggerClick,this))},onTriggerClick:function(a){this.renderCSS()},renderCSS:function(){var a=this.app.kapi.toCSS({vendors:c(this.app),name:this.app.view.cssNameFieldView.$el.val()});this.$el.val(a)}})}),define("src/ui/html-input",["exports"],function(a){a.view=Backbone.View.extend({events:{keyup:"onKeyup"},initialize:function(a){_.extend(this,a),this.$renderTarget=$("#rekapi-canvas .rekapi-actor"),this.initialValue=this.readFromDOM()},onKeyup:function(){this.renderToDOM()},readFromDOM:function(){return this.$el.html(this.app.util.trimString(this.$renderTarget.html()))},renderToDOM:function(){var a=this.$el.val()||this.initialValue;this.$renderTarget.html(a)}})}),define("src/ui/incrementer-field",["exports","src/ui/auto-update-textfield"],function(a,b){a.view=b.view.extend({increment:10,initialize:function(a){b.view.prototype.initialize.call(this,a)},tweakVal:function(a){this.$el.val(parseInt(this.$el.val(),10)+a),this.$el.trigger("keyup")},onArrowUp:function(){this.tweakVal(this.increment)},onArrowDown:function(){this.tweakVal(-this.increment)}})}),define("src/ui/keyframe",["exports","src/ui/incrementer-field"],function(a,b){function c(a){return new b.view({app:this.app,$el:a,onValReenter:_.bind(function(b){this.model.set(a.data("keyframeattr"),+b),publish(this.app.const.KEYFRAME_UPDATED),this.app.collection.keyframes.updateModelCrosshairViews(),this.app.util.redrawKapi(this.app.kapi)},this)})}a.view=Backbone.View.extend({events:{},KEYFRAME_TEMPLATE:['<li class="keyframe">',"<h3></h3>","<label>","<span>Left:</span>",'<input class="third-width keyframe-attr-x" type="text" data-keyframeattr="x"></input>',"</label>","<label>","<span>Top:</span>",'<input class="third-width keyframe-attr-y" type="text" data-keyframeattr="y"></input>',"</label>","<hr>","</li>"].join(""),initialize:function(a){_.extend(this,a),this.app=this.owner.app,this.$el=$(this.KEYFRAME_TEMPLATE),this.model.keyframeView=this,this.initDOMReferences(),this.initIncrementers(),this.render()},initDOMReferences:function(){this.header=this.$el.find("h3"),this.inputX=this.$el.find(".keyframe-attr-x"),this.inputY=this.$el.find(".keyframe-attr-y")},initIncrementers:function(){this.incrementerViews={},_.each([this.inputX,this.inputY],function(a){this.incrementerViews[a.data("keyframeattr")]=c.call(this,a)},this)},render:function(){this.header.html(this.model.get("percent")+"%"),this.model.get("x")!==+this.inputX.val()&&this.inputX.val(this.model.get("x")),this.model.get("y")!==+this.inputY.val()&&this.inputY.val(this.model.get("y"))}})}),define("src/model/keyframe",["exports"],function(a){a.model=Backbone.Model.extend({initialize:function(a,b){_.extend(this,b),subscribe(this.app.const.KEYFRAME_UPDATED,_.bind(this.updateActor,this))},validate:function(a){var b=!1;_.each(a,function(a){typeof a!="number"&&(b=!0)});if(b)return"Number is NaN"},updateActor:function(){this.app.canvasView&&this.app.canvasView.backgroundView.update();var a=this.get("percent")===0?0:this.app.config.animationDuration;this.app.config.currentActor&&(this.app.config.currentActor.modifyKeyframe(a,this.getCSS()),this.app.util.redrawKapi(this.app.kapi))},getCSS:function(){return{transform:"translateX("+this.get("x")+"px) translateY("+this.get("y")+"px)"}},getAttrs:function(){return{x:this.get("x"),y:this.get("y")}}})}),define("src/ui/crosshair",["exports","src/model/keyframe"],function(a,b){a.view=Backbone.View.extend({events:{},initialize:function(a){_.extend(this,a),this.$el.dragon({within:this.$el.parent(),drag:_.bind(this.drag,this),dragEnd:_.bind(this.dragEnd,this)}),this.model.set("percent",+this.$el.data("percent")),this.model.crosshairView=this,this.updateModel()},drag:function(a,b){this.updateModel()},dragEnd:function(a,b){this.drag.apply(this,arguments),this.app.view.cssOutputView.renderCSS(),publish(this.app.const.UPDATE_CSS_OUTPUT)},render:function(){this.$el.css({left:this.model.get("x")+"px",top:this.model.get("y")+"px"})},updateModel:function(){var a=this.app.util.pxToNumber;this.model.set({x:a(this.$el.css("left")),y:a(this.$el.css("top"))}),publish(this.app.const.KEYFRAME_UPDATED),this.app.collection.keyframes.updateModelKeyframeViews(),this.app.kapi&&this.app.util.redrawKapi(this.app.kapi)}})}),define("src/collection/keyframes",["exports","src/model/keyframe"],function(a,b){a.collection=Backbone.Collection.extend({model:b.model,initialize:function(){},updateModelViews:function(){_.each(this.models,function(a){a.crosshairView.render(),a.keyframeView.render()})},updateModelKeyframeViews:function(){if(!this.models[0].keyframeView)return;_.each(this.models,function(a){a.keyframeView.render()})},updateModelCrosshairViews:function(){if(!this.models[0].crosshairView)return;_.each(this.models,function(a){a.crosshairView.render()})}})}),define("src/ui/keyframes",["src/collection/keyframes","src/ui/keyframe"],function(a,b){return a.view=Backbone.View.extend({events:{},initialize:function(a){_.extend(this,a),this.keyframeViews={},this.initKeyframeViews()},initKeyframeViews:function(){this.collection.each(function(a){var b=this.initKeyframeView(a);this.$el.append(b.$el)},this)},initKeyframeView:function(a){var c=new b.view({owner:this,model:a});return this.keyframeViews[c.cid]=c,c},render:function(){_.each(this.keyframeViews,function(a){a.render()})}}),a}),require(["src/utils","src/ui/checkbox","src/ui/button","src/ui/select","src/ui/auto-update-textfield","src/ui/ease-field","src/ui/crosshair","src/ui/canvas","src/ui/pane","src/ui/tabs","src/ui/css-output","src/ui/html-input","src/ui/keyframes","src/ui/incrementer-field","src/model/keyframe"],function(utils,checkbox,button,select,autoUpdateTextfield,easeField,crosshair,canvas,pane,tabs,cssOutput,htmlInput,keyframes,incrementerField,keyframe){var $win=$(window),app={config:{activeClasses:{}},"const":{},events:{},util:{},view:{},collection:{}};app.const.PRERENDER_GRANULARITY=150,app.const.RENDER_GRANULARITY=100,app.const.KEYFRAME_UPDATED="keyframeUpdated",app.const.UPDATE_CSS_OUTPUT="updateCSSOutput",app.config.activeClasses.moz=!0,app.config.activeClasses.webkit=!0,app.config.activeClasses.w3=!0,utils.init(app);var customEase1FnString=["Tweenable.prototype.formula.customEase1 = ","function (x) {return Math.pow(x, 4);}"].join("");eval(customEase1FnString);var customEase2FnString=["Tweenable.prototype.formula.customEase2 = ","function (x) {return Math.pow(x, 0.25);}"].join("");eval(customEase2FnString),app.config.selects={x:new select.view({$el:$("#x-easing"),app:app}),y:new select.view({$el:$("#y-easing"),app:app})},app.view.durationFieldView=new incrementerField.view({app:app,$el:$("#duration"),onValReenter:function(a){if(!isNaN(a)){var b=Math.abs(a);this.app.util.moveLastKeyframe(this.app.config.currentActor,b)}}}),app.config.animationDuration=app.config.initialDuration=+app.view.durationFieldView.$el.val(),app.config.easeFields=[],$(".ease").each(function(a,b){var c=new easeField.view({$el:$(b),app:app});app.config.easeFields.push(c)}),app.collection.keyframes=new keyframes.collection,$(".crosshair").each(function(a,b){var c=$(b);app.collection.keyframes.add({x:a?$win.width()-$win.width()/(a+1):40,y:$win.height()/2-c.height()/2},{app:app});var d=app.collection.keyframes.last().getAttrs();c.css({left:d.x,top:d.y}),new crosshair.view({app:app,$el:c,model:app.collection.keyframes.last()})}),app.view.keyframes=new keyframes.view({app:app,$el:$("#keyframe-controls .controls"),collection:app.collection.keyframes}),app.canvasView=new canvas.view({app:app,$el:$("#rekapi-canvas"),$canvasBG:$("#tween-path")}),app.canvasView.backgroundView.update(),app.kapi.play(),app.view.showPathView=new checkbox.view({app:app,$el:$("#show-path"),preventInitialHandlerCall:!0,onChange:function(a,b){this.app.config.isPathShowing=!!b,this.app.util.redrawKapi(this.app.kapi),this.app.canvasView.backgroundView.update()}}),app.view.controlPaneView=new pane.view({app:app,$el:$("#control-pane")}),app.view.controlPaneTabsView=new tabs.view({app:app,$el:$("#control-pane")}),app.view.cssOutputView=new cssOutput.view({app:app,$el:$("#css-output textarea"),$trigger:app.view.controlPaneTabsView.$el.find('[data-target="css-output"]')}),subscribe(app.const.UPDATE_CSS_OUTPUT,function(){app.view.cssOutputView.renderCSS()}),app.view.cssNameFieldView=new autoUpdateTextfield.view({app:app,$el:$("#css-name"),onKeyup:function(a){this.app.config.className=a,publish(app.const.UPDATE_CSS_OUTPUT)}}),app.view.mozCheckboxView=new checkbox.view({app:app,$el:$("#moz-toggle"),onChange:function(a,b){this.app.config.activeClasses.moz=b,publish(app.const.UPDATE_CSS_OUTPUT)}}),app.view.webkitCheckboxView=new checkbox.view({app:app,$el:$("#webkit-toggle"),onChange:function(a,b){this.app.config.activeClasses.webkit=b,publish(app.const.UPDATE_CSS_OUTPUT)}}),app.view.w3CheckboxView=new checkbox.view({app:app,$el:$("#w3-toggle"),onChange:function(a,b){this.app.config.activeClasses.w3=b,publish(app.const.UPDATE_CSS_OUTPUT)}}),app.view.htmlInputView=new htmlInput.view({app:app,$el:$("#html-input textarea")}),$(window).trigger("resize")}),define("src/init",function(){})